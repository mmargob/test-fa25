---
title: "SMML Class 2 Lab"
author: "Sunghee Lee"
date: "9/2/2025"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
header-includes:
- \usepackage{bbm}
- \usepackage{setspace}
- \singlespacing
number_sections: yes
fontsize: 12pt
---


```{r setup, include=FALSE, tidy=TRUE}
knitr::opts_chunk$set(echo = TRUE,cache=TRUE, 
                      autodep=TRUE, cache.comments=FALSE,
                      message=FALSE, warning=FALSE,
                      fig.width=4.5, fig.height=3.5)
```



##  We will use \texttt{Wage} data in R package \texttt{ISLR} <br>
```{r, echo=FALSE} 
library(ISLR) 
```
hello
```{r}
data("Wage") 
dim(Wage)
summary(Wage)
```
 
### 1. Focus on the variable, \texttt{wage}
A. What is the mean and the variance of \texttt{wage}?
```{r}
mean(Wage$wage)
var(Wage$wage)
```
* The mean is `r round(mean(Wage$wage),3)` and the variance is `r round(var(Wage$wage),3)`.\

B. What is the sampling variance of the estimated mean and the 95% confidence interval of the true mean? 
```{r}
n<-dim(Wage)[[1]]
samvar<-var(Wage$wage)/(n-1)
samvar

t.score<-qt(p=.05/2, df=n-1, lower.tail=F)
t.score

lowCI <- mean(Wage$wage)-t.score*sqrt(samvar)
upCI <- mean(Wage$wage)+t.score*sqrt(samvar)
print(c(lowCI,upCI))

t.test(Wage$wage, conf.level = 0.95)
```
* $SE(\bar{y})=0.5806188$
* The 95% confidence interval of $\mu_{wage}$ is $[110.2095, 113.1977]$\
C. What are the steps to take to compare \texttt{wage} of those without vs. with college or higher education?  
$H_0: \mu_{\ge CollEduc}=\mu_{<CollEduc}$ vs. $H_A: \mu_{\ge CollEduc} \neq \mu_{<CollEduc}$ 

  * Step 1) Recode \texttt{education}
  * Step 2) Check means and variances by recoded education
  * Step 3) Test equal variance 
  * Step 4) Conduct proper testing 
 
Step 1) Recode \texttt{education}
```{r}
library(tidyverse)
table(Wage$education)
Wage<-Wage%>%
  mutate(CollEduc=ifelse(education=="4. College Grad"|
                         education=="5. Advanced Degree",1,0))
```

Step 2) Check means and variances by recoded education
```{r}
Wage%>%
  group_by(CollEduc)%>%
  summarize(m=mean(wage),
            var=var(wage))
```

* $\hat\mu_{<CollEduc}=\hat{\bar{y}}_{<CollEduc}=98.2$ and $\hat{\sigma}^2_{<CollEduc}=s^2_{<CollEduc}=910$
* $\hat\mu_{\ge CollEduc}=\hat{\bar{y}}_{\ge CollEduc}=135$ and $\hat{\sigma}^2_{\ge CollEduc}=s^2_{\ge CollEduc}=2324$ \

Step 3) Test equal variance
* Corresponding hypothesis: $H_0:\sigma^2_{<CollEduc}=\sigma^2_{\ge CollEduc}$ vs. $H_A:\sigma^2_{< CollEduc}\neq\sigma^2_{\ge CollEduc}$

```{r}
var.test(wage ~ CollEduc, Wage, alternative = "two.sided")
```
* We conclude that $H_0:\sigma^2_{<CollEduc}=\sigma^2_{\ge CollEduc}$ does not hold \

Step 4) Conduct proper testing
* Corresponding hypothesis: $H_0: \mu_{<CollEduc}=\mu_{\ge CollEduc}$ vs. $H_A: \mu_{<CollEduc} \neq \mu_{\ge CollEduc}$
```{r}
t.test(wage ~ CollEduc, Wage, var.equal=FALSE)
#If equal variance: 
#   t.test(wage ~ CollEduc, Wage, var.equal=TRUE)
#If one-sides test
#   t.test(wage ~ CollEduc, Wage, var.equal=FALSE, alternative="less")
```
* We reject $H_0: \mu_{<CollEduc}=\mu_{\ge CollEduc}$\

D. What are your conclusions about the comparison in C?

* We reject $H_0: \mu_{<CollEduc}=\mu_{\ge CollEduc}$, meaning that the wage is not the same for those with vs. without college or higher education.
* The difference of wage between those with vs. without college or higher education, $\delta_{CollEduc}=\mu_{<CollEduc}-\mu_{\ge CollEduc}$, is somewhere between -39.486 and -33.192 at 95% confidence. I.e., 95% confidence interval of $\delta_{CollEduc}$ is: $[-39.486, -33.192]$.\

E. What is the correlation coefficient between \texttt{wage} and \texttt{age}? 
```{r}
cor(Wage$wage, Wage$age)
cor.test(Wage$wage, Wage$age)
```
\hfill

F. What are the conclusions from E? 

* $\hat{\rho}=r=0.196$
* $H_0:\rho=0$ vs. $H_A: \rho \neq 0$ $\rightarrow$ Reject $H_0$
* 95% CI of $\rho$: [0.161,0.230] \
  
G. Can we use conclusions from above?

* Yes, we have statistics from the sample and made inference for the population.

\newpage

### 2. Focus on the variable, \texttt{logwage}

A. What is the mean and the variance?
```{r}
mean(Wage$logwage)
var(Wage$logwage)
```
* The mean is `r round(mean(Wage$logwage),3)` and the variance is `r round(var(Wage$logwage),3)`\

B. What is the sampling variance of the mean and the 95% confidence interval of the true mean? 
```{r}
n<-dim(Wage)[[1]]
samvar<-var(Wage$logwage)/n

samvar

t.test(Wage$logwage, conf.level = 0.95)
```
* The sampling variance is `r samvar`
* The 95% confidence interval of $\mu_{logwage}$ is $[4.641313, 4.666497]$\

C. Does \texttt{logwage} follow a normal distribution? How does this compare to \texttt{logwage} we examined in the last class?
```{r}
ggplot(Wage, aes(x=logwage)) + geom_histogram(binwidth=0.1)
qqnorm(Wage$logwage, main="Log Wage", ylab="y_{i:n}", xlab="m_{i:n}"); 
qqline(Wage$logwage, col="red",lwd=2)
```

```{r}
ggplot(Wage, aes(x=wage)) + geom_histogram(binwidth=0.1)
qqnorm(Wage$wage, main="Wage", ylab="y_{i:n}", xlab="m_{i:n}"); 
qqline(Wage$wage, col="red",lwd=2)
```

```{r}
shapiro.test(Wage$logwage)
```
* While, compared to \texttt{wage}, \texttt{logwage} appears more normally distributed, it still fails to meet the normal distribution requirements.\

D. What is the relationship between \texttt{wage} and \texttt{logwage}?
```{r}
ggplot(Wage, aes(x=wage,y=logwage)) + geom_point()
```

* The relationship is not linear; positive monotonic.\

E. What is this variable, \texttt{logwage}?

```{r}
mean(log(Wage$wage))
mean(Wage$logwage)
```

```{r}
Wage<-Wage%>%
  mutate(mylogwage=log(wage))

Wage[1:10,c("logwage","mylogwage")]
```


